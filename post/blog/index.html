<!doctype html>
<html lang="en-us">
  <head>
    <title>支付宝沙箱的使用 // My New Hugo Site</title>
    <link rel="shortcut icon" href="/favicon.ico" />
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.92.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="John Doe" />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://title445.github.io/css/main.min.88e7083eff65effb7485b6e6f38d10afbec25093a6fac42d734ce9024d3defbd.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="支付宝沙箱的使用"/>
<meta name="twitter:description" content="支付宝沙箱扫码支付的使用
1. 登陆支付宝沙箱环境 2. 设置环境 (1) 启用密钥
3. 查看扫码api接口 (1) 本教程使用下图两个api实现扫码支付
线下交易预创建
线下交易支付查询
4. 接口调用前提 ①　依赖导入 com.alibabafastjson1.2.76com.alipay.sdk​ alipay-sdk-java4.16.41.ALL②　创建支付请求客户端的工具类AlipayUtil public class AlipayUtil { public static final String PRIVATE_KEY =; public static final String PUBLIC_KEY =; public static final String APP_ID = ; public static final String DEV_SERVER_API = &quot;https://openapi.alipaydev.com/gateway.do&quot;; public static final String FORMAT = &quot;json&quot;; public static final String CHARSET = &quot;utf-8&quot;; public static final String SIGN_TYPE = &quot;RSA2&quot;; private static volatile AlipayClient alipayClient = null; private AlipayUtil(){ } public static AlipayClient getAlipayClient(){ if (alipayClient==null){ synchronized (AlipayUtil."/>

    <meta property="og:title" content="支付宝沙箱的使用" />
<meta property="og:description" content="支付宝沙箱扫码支付的使用
1. 登陆支付宝沙箱环境 2. 设置环境 (1) 启用密钥
3. 查看扫码api接口 (1) 本教程使用下图两个api实现扫码支付
线下交易预创建
线下交易支付查询
4. 接口调用前提 ①　依赖导入 com.alibabafastjson1.2.76com.alipay.sdk​ alipay-sdk-java4.16.41.ALL②　创建支付请求客户端的工具类AlipayUtil public class AlipayUtil { public static final String PRIVATE_KEY =; public static final String PUBLIC_KEY =; public static final String APP_ID = ; public static final String DEV_SERVER_API = &quot;https://openapi.alipaydev.com/gateway.do&quot;; public static final String FORMAT = &quot;json&quot;; public static final String CHARSET = &quot;utf-8&quot;; public static final String SIGN_TYPE = &quot;RSA2&quot;; private static volatile AlipayClient alipayClient = null; private AlipayUtil(){ } public static AlipayClient getAlipayClient(){ if (alipayClient==null){ synchronized (AlipayUtil." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://title445.github.io/post/blog/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-02-24T20:13:18+08:00" />
<meta property="article:modified_time" content="2022-02-24T20:13:18+08:00" />



  </head>
  <body>
    <header class="app-header">
      <a href="https://title445.github.io/"><img class="app-header-avatar" src="/avatar.jpg" alt="John Doe" /></a>
      <h1>My New Hugo Site</h1>
      <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Nunc vehicula turpis sit amet elit pretium.</p>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">支付宝沙箱的使用</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Feb 24, 2022
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div>
      </div>
    </header>
    <div class="post-content">
      <p><strong>支付宝沙箱扫码支付的使用</strong></p>
<h2 id="1---登陆支付宝沙箱环境httpsauthalipaycomloginant_sso_indexhtmgotohttps3a2f2fopenalipaycom2fplatform2fappdailyhtm3ftab3dinfo">1.   登陆<a href="https://auth.alipay.com/login/ant_sso_index.htm?goto=https%3A%2F%2Fopen.alipay.com%2Fplatform%2FappDaily.htm%3Ftab%3Dinfo">支付宝沙箱环境</a></h2>
<h2 id="2---设置环境">2.   设置环境</h2>
<p>(1)   启用密钥</p>
<h2 id="3---查看扫码api接口httpsopendocsalipaycomapisapi_1alipaytradeprecreate">3.   查看<a href="https://opendocs.alipay.com/apis/api_1/alipay.trade.precreate">扫码api接口</a></h2>
<p>(1)   本教程使用下图两个api实现扫码支付</p>
<p>线下交易预创建</p>
<p>线下交易支付查询</p>
<h2 id="4---接口调用前提">4.   接口调用前提</h2>
<h3 id="依赖导入">①　依赖导入</h3>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->com.alibaba<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->fastjson<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->1.2.76<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<p><!-- raw HTML omitted -->com.alipay.sdk<!-- raw HTML omitted --></p>
<p>​    <!-- raw HTML omitted -->alipay-sdk-java<!-- raw HTML omitted --></p>
<p><!-- raw HTML omitted -->4.16.41.ALL<!-- raw HTML omitted --></p>
<!-- raw HTML omitted -->
<h3 id="创建支付请求客户端的工具类alipayutil">②　创建支付请求客户端的工具类AlipayUtil</h3>
<pre tabindex="0"><code>public class AlipayUtil {
    public static final String PRIVATE_KEY =;
    public static final String PUBLIC_KEY =;
    public static final String APP_ID = ;
    public static final String DEV_SERVER_API = &quot;https://openapi.alipaydev.com/gateway.do&quot;;
    public static final String FORMAT = &quot;json&quot;;
    public static final String CHARSET = &quot;utf-8&quot;;
    public static final String SIGN_TYPE = &quot;RSA2&quot;;
private static volatile AlipayClient alipayClient = null;
    private AlipayUtil(){ }
    public static AlipayClient getAlipayClient(){
    if (alipayClient==null){
        synchronized (AlipayUtil.class){
            if (alipayClient==null){
                alipayClient = new DefaultAlipayClient(
                AlipayUtil.DEV_SERVER_API,
                AlipayUtil.APP_ID,
                AlipayUtil.PRIVATE_KEY,
                AlipayUtil.FORMAT ,
                AlipayUtil.CHARSET ,
                AlipayUtil.PUBLIC_KEY,
                AlipayUtil.SIGN_TYPE );  //获得初始化的AlipayClient
            }
        }
    }
    return alipayClient;
   }
}
</code></pre><h3 id="修改工具类里的参数需要修改三个参数">③　修改工具类里的参数，需要修改三个参数</h3>
<ol>
<li>
<p>PRIVATE_KEY   应用私钥</p>
</li>
<li>
<p>PUBLIC_KEY     支付宝公钥</p>
</li>
<li>
<p>APP_ID</p>
</li>
</ol>
<h3 id="下载沙箱版支付宝只有android版">④　下载沙箱版支付宝（只有Android版）</h3>
<p>下载并登陆</p>
<h2 id="5---接口调用顺序说明">5.   接口调用顺序说明</h2>
<h3 id="调用交易预创建接口alipaytradeprecreate">①　调用交易预创建接口（alipay.trade.precreate）</h3>
<ol>
<li>请求参数</li>
</ol>
<p>out_trade_no  时间戳</p>
<p>total_amount  扫码支付金额</p>
<p>subject    商品名称</p>
<ol start="2">
<li>目的：获得响应参数中qr_code的值用于生成支付的二维码</li>
</ol>
<h3 id="调用交易查询接口alipaytradequery">②　调用交易查询接口（alipay.trade.query）</h3>
<ol>
<li>请求参数</li>
</ol>
<p>①的请求参数out_trade_out</p>
<ol start="2">
<li>目的：获得响应参数trade_status用于查询本次交易的支付状态（成功、失败、取消等），其他返回值自己使用</li>
</ol>
<h2 id="6---实现扫码支付">6.   实现扫码支付</h2>
<h3 id="代码">①　代码</h3>
<pre tabindex="0"><code>@Test
    public void qrCode(){
        System.out.println(&quot;==================订单预创建，获得二维码链接====================&quot;);
        AlipayClient alipayClient = AlipayUtil.getAlipayClient();  //获得初始化的AlipayClient
        AlipayTradePrecreateRequest request = new AlipayTradePrecreateRequest (); //创建API对应的request类
 
        String outTradeNo = new Date().getTime()+&quot;xianmiao&quot;;//商户订单编号，这里使用时间戳
 
        JSONObject bizContent = new JSONObject();
        bizContent.put(&quot;out_trade_no&quot;, outTradeNo);//商户订单号，自定义
        bizContent.put(&quot;total_amount&quot;, 3.5);//付款金额
        bizContent.put(&quot;subject&quot;, &quot;百事可乐200ml&quot;);//商品名称
//        bizContent.put(&quot;store_id&quot;, &quot;鲜喵货柜_001&quot;);//商家id，可以没有
        bizContent.put(&quot;timeout_express&quot;, &quot;90m&quot;);//超时时间
        //传入参数
        request.setBizContent ( bizContent.toString() ); //订单允许的最晚付款时间
        AlipayTradePrecreateResponse response = null;
        try {
            response = alipayClient.execute (request);//执行预创建
        } catch (AlipayApiException e) {
            e.printStackTrace();
        }
        String respBody = response.getBody();
//        System.out.println(respBody);
        //转json对象
        JSONObject jsonBodyObject = JSONObject.parseObject(respBody);
        JSONObject respObject = JSONObject.parseObject(jsonBodyObject.get(&quot;alipay_trade_precreate_response&quot;).toString());
 
        //取出二维码地址，返回给前端使用二维码生成器生成二维码
        String qrCode = (String) respObject.get(&quot;qr_code&quot;);
        System.out.println(&quot;生成的二维码链接：&quot;+qrCode);
        //其他业务
    }
</code></pre><h3 id="运行结果">②　运行结果</h3>
<p>为一个二维码连接(地址)</p>
<h3 id="将这个链接复制到二维码工具httpsqrcodebmcxcom传到前端则使用vue生成二维码httpsblogcsdnnetweixin_30745641articledetails97824258">③　将这个链接复制到<a href="https://qrcode.bmcx.com/">二维码工具</a>（传到前端则使用<a href="https://blog.csdn.net/weixin_30745641/article/details/97824258">vue生成二维码</a>）</h3>
<h3 id="生成二维码后使用沙箱支付宝_下载沙箱版支付宝只有android版扫一扫">④　生成二维码后使用<a href="#_%E4%B8%8B%E8%BD%BD%E6%B2%99%E7%AE%B1%E7%89%88%E6%94%AF%E4%BB%98%E5%AE%9D%EF%BC%88%E5%8F%AA%E6%9C%89Android%E7%89%88%EF%BC%89">沙箱支付宝</a>扫一扫</h3>
<p>支付密码   111111</p>
<h2 id="7---订单支付状态获取">7.   订单支付状态获取</h2>
<p>注意：传入的out_trade__no与<a href="#_%E4%BB%A3%E7%A0%81">预创建</a>中的一致，可以到<a href="#_%E8%BF%90%E8%A1%8C%E7%BB%93%E6%9E%9C">6.2</a>的输出结果中赋值</p>
<h3 id="代码-1">①　代码</h3>
<pre tabindex="0"><code>    @Test
    public void queryPayStatus(){
        System.out.println(&quot;==================查询支付状态====================&quot;);
        AlipayClient alipayClient = AlipayUtil.getAlipayClient();
        AlipayTradeQueryRequest request = new AlipayTradeQueryRequest();
        JSONObject bizContent = new JSONObject();
        //设置查询订单的商号
        bizContent.put(&quot;out_trade_no&quot;, &quot;1631425172997xianmiao&quot;);
//        bizContent.put(&quot;trade_no&quot;,tradeNo);
        request.setBizContent(bizContent.toString());
        AlipayTradeQueryResponse response = null;
        try {
            response = alipayClient.execute(request);
        } catch (AlipayApiException e) {
            e.printStackTrace();
        }
        String respBody = response.getBody();
//        System.out.println(respBody);
        //转json对象
        JSONObject jsonBodyObject = JSONObject.parseObject(respBody);
        JSONObject respObject = JSONObject.parseObject(jsonBodyObject.get(&quot;alipay_trade_query_response&quot;).toString());
        System.out.println(&quot;订单状态：&quot;+respObject.get(&quot;trade_status&quot;));
    }
</code></pre><h3 id="结果">②　结果</h3>
<p>TRADE_SUCCESS</p>
<h2 id="8---by鲜喵">8.   By鲜喵</h2>

    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
